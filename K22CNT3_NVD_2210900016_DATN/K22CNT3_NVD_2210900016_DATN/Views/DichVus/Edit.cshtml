@model K22CNT3_NVD_2210900016_DATN.Models.DichVu

@{
    ViewBag.Title = "Chỉnh sửa dịch vụ";
}

<div class="container mt-4">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                <i class="fas fa-edit me-2"></i>Chỉnh sửa dịch vụ
            </h4>
        </div>

        @using (Html.BeginForm("Edit", "DichVus", FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(m => m.ID_DichVu)

            <div class="card-body">

                <!-- TÊN DỊCH VỤ -->
                <div class="mb-3">
                    @Html.LabelFor(m => m.TenDichVu, "Tên dịch vụ", new { @class = "form-label fw-bold" })
                    @Html.TextBoxFor(m => m.TenDichVu, new
                    {
                        @class = "form-control",
                        maxlength = 200,
                        id = "TenDichVu"
                    })
                    <small class="text-muted" id="tenCount">
                        @(Model.TenDichVu?.Length ?? 0)/200 ký tự
                    </small>
                    @Html.ValidationMessageFor(m => m.TenDichVu, "", new { @class = "text-danger" })
                </div>

                <div class="row">
                    <!-- LOẠI DỊCH VỤ -->
                    <div class="col-md-6 mb-3">
                        @Html.LabelFor(m => m.ID_LoaiDV, "Loại dịch vụ", new { @class = "form-label fw-bold" })
                        @Html.DropDownList(
                            "ID_LoaiDV",
                            null,
                            "-- Chọn loại dịch vụ --",
                            new { @class = "form-select" }
                        )
                        @Html.ValidationMessageFor(m => m.ID_LoaiDV, "", new { @class = "text-danger" })
                    </div>

                    <!-- ĐƠN GIÁ -->
                    <div class="col-md-6 mb-3">
                        @Html.LabelFor(m => m.DonGia, "Đơn giá (VNĐ)", new { @class = "form-label fw-bold" })
                        @Html.TextBoxFor(m => m.DonGia, new
                        {
                            @class = "form-control",
                            type = "number",
                            min = "0",
                            step = "1000"
                        })
                        @Html.ValidationMessageFor(m => m.DonGia, "", new { @class = "text-danger" })
                    </div>
                </div>

                <!-- THỜI GIAN -->
                <div class="mb-3">
                    @Html.LabelFor(m => m.ThoiGianThucHien, "Thời gian thực hiện (phút)", new { @class = "form-label fw-bold" })
                    @Html.TextBoxFor(m => m.ThoiGianThucHien, new
                    {
                        @class = "form-control",
                        type = "number",
                        min = "1"
                    })
                </div>

                <!-- TRẠNG THÁI (SỬA CHUẨN bool?) -->
                <div class="mb-4">
                    <label class="form-label fw-bold">Trạng thái dịch vụ</label>

                    <!-- Hidden để đảm bảo luôn gửi về server -->
                    @Html.Hidden("TrangThai", Model.TrangThai ?? false)

                    <div class="form-check form-switch">
                        <input type="checkbox"
                               id="TrangThaiSwitch"
                               class="form-check-input"
                               @(Model.TrangThai == true ? "checked" : "") />

                        <label class="form-check-label fw-semibold" id="TrangThaiText">
                            @(Model.TrangThai == true
                                ? "Đang hoạt động"
                                : "Ngừng hoạt động")
                        </label>
                    </div>

                    <small class="text-muted">
                        Dịch vụ ngừng hoạt động sẽ không hiển thị khi đặt hàng
                    </small>
                </div>
            </div>

            <!-- FOOTER -->
            <div class="card-footer bg-light d-flex justify-content-between">
                <a href="@Url.Action("Index")" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Quay lại
                </a>

                <button type="submit" class="btn btn-success px-4">
                    <i class="fas fa-save me-1"></i>Lưu thay đổi
                </button>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Đếm ký tự tên dịch vụ
        const tenInput = document.getElementById('TenDichVu');
        const tenCount = document.getElementById('tenCount');

        if (tenInput) {
            tenInput.addEventListener('input', function () {
                tenCount.innerText = this.value.length + "/200 ký tự";
            });
        }

        // Đồng bộ trạng thái checkbox -> hidden
        const sw = document.getElementById('TrangThaiSwitch');
        const txt = document.getElementById('TrangThaiText');
        const hidden = document.querySelector('input[name="TrangThai"]');

        if (sw) {
            sw.addEventListener('change', function () {
                if (this.checked) {
                    txt.innerText = "Đang hoạt động";
                    txt.className = "form-check-label text-success fw-semibold";
                    hidden.value = "true";
                } else {
                    txt.innerText = "Ngừng hoạt động";
                    txt.className = "form-check-label text-danger fw-semibold";
                    hidden.value = "false";
                }
            });
        }
    </script>
}
