@model IEnumerable<K22CNT3_NVD_2210900016_DATN.Models.LichSuTichDiem>

@{
    ViewBag.Title = "Lịch sử tích điểm";
}

<h2 class="text-primary mb-3">📊 Lịch sử tích điểm</h2>

<div class="mb-3">
    @Html.ActionLink("➕ Thêm lịch sử", "Create", null, new { @class = "btn btn-success" })
</div>

<div class="card shadow-sm">
    <div class="card-body">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>Điểm +</th>
                    <th>Điểm -</th>
                    <th>Lý do</th>
                    <th>Ngày</th>
                    <th>Đơn DV</th>
                    <th>Đơn hàng</th>
                    <th>Mã thẻ</th>
                    <th width="180">Chức năng</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="8" class="text-center text-muted">
                            Chưa có lịch sử tích điểm
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model)
                    {
                        <tr class="text-center">
                            <!-- Điểm cộng -->
                            <td class="text-success fw-bold">
                                @(item.DiemCong.HasValue && item.DiemCong > 0
                                    ? "+" + item.DiemCong
                                    : "-")
                            </td>

                            <!-- Điểm trừ -->
                            <td class="text-danger fw-bold">
                                @(item.DiemTru.HasValue && item.DiemTru > 0
                                    ? "-" + item.DiemTru
                                    : "-")
                            </td>

                            <!-- Lý do -->
                            <td class="text-start">
                                @item.LyDo
                            </td>

                            <!-- Ngày tích điểm -->
                            <td>
                                @(item.NgayTichDiem.HasValue
                                    ? item.NgayTichDiem.Value.ToString("dd/MM/yyyy HH:mm")
                                    : "-")
                            </td>

                            <!-- Đơn dịch vụ -->
                            <td>
                                @(item.ID_DonDV.HasValue
                                    ? item.ID_DonDV.ToString()
                                    : "-")
                            </td>

                            <!-- Đơn hàng -->
                            <td>
                                @(item.ID_DonHang.HasValue
                                    ? item.ID_DonHang.ToString()
                                    : "-")
                            </td>

                            <!-- Mã thẻ hội viên -->
                            <td>
                                @(item.HoiVien != null
                                ? item.HoiVien.MaThe
                                : "-")
                            </td>

                            <!-- Chức năng -->
                            <td>
                                @Html.ActionLink("✏️", "Edit", new { id = item.ID_LichSu }, new { @class = "btn btn-sm btn-warning me-1" })
                                @Html.ActionLink("👁️", "Details", new { id = item.ID_LichSu }, new { @class = "btn btn-sm btn-info text-white me-1" })
                                @Html.ActionLink("🗑️", "Delete", new { id = item.ID_LichSu }, new { @class = "btn btn-sm btn-danger" })
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
